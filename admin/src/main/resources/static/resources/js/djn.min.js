function init(){var e=document.querySelector("#fileUpload");null!=e&&e.addEventListener("change",handleFileSelect,!1);for(var t=document.querySelectorAll(".form-editable"),i=0;i<t.length;i++)t[i].addEventListener("change",updateThis);selDiv=document.querySelector("#selectedFiles"),topInsert=document.querySelector("#top_insert"),path_input=document.getElementById("path");var n=document.getElementById("assets");path_input&&(path_input.addEventListener("change",function(){n.submit()}),path=path_input.getAttribute("value"))}function updateProperty(e){var t=e.getAttribute("id"),i=e.getAttribute("uid"),n=e.getAttribute("path"),a=e.getAttribute("name"),s=e.getAttribute("type"),l="checkbox"==s?$(e).is(":checked"):e.value;$.ajax({url:contentPath+"/updateProperty.html",data:{uid:i,name:a,path:n,value:l},type:"POST",success:function(e){"checkbox"==s?document.getElementById(t).parentNode.classList.add("alert-success"):e.indexOf("error:")>=0?document.getElementById(t).classList.add("alert-warning"):document.getElementById(t).classList.add("alert-success")},error:function(){document.getElementById(t).classList.add("alert-warning")}})}function updateNode(e){var t=e.getAttribute("id"),i=e.getAttribute("uid"),n=e.getAttribute("path"),a=e.getAttribute("name"),s=e.getAttribute("type"),l="checkbox"==s?$(e).is(":checked"):e.value;$.ajax({url:contentPath+"/updateNodeProperty.html",data:{uid:i,name:a,path:n,value:l},type:"POST",success:function(e){"checkbox"==s?document.getElementById(t).parentNode.classList.add("alert-success"):e.indexOf("error:")>=0?document.getElementById(t).classList.add("alert-warning"):document.getElementById(t).classList.add("alert-success")},error:function(){document.getElementById(t).classList.add("alert-warning")}})}function updateThis(){var e=this.getAttribute("id"),t=this.getAttribute("uid"),i=this.getAttribute("path"),n=this.getAttribute("name"),a=this.getAttribute("type"),s="checkbox"==a?$(this).is(":checked"):this.value;$.ajax({url:contentPath+"/updateProperty.html",data:{uid:t,path:i,name:n,value:s},type:"POST",success:function(t){"checkbox"==a?document.getElementById(e).parentNode.classList.add("alert-success"):t.indexOf("error:")>=0?document.getElementById(e).classList.add("alert-warning"):document.getElementById(e).classList.add("alert-success")},error:function(){document.getElementById(e).classList.add("alert-warning")}})}function openFiles(){selDiv=document.querySelector("#selectedFiles"),fileUpload=document.querySelector("#fileUpload"),fileUpload.click()}function resetSelDiv(){selDiv=document.querySelector("#selectedFiles"),selDiv.innerHTML="",total=0,document.getElementById("submit_upload").disabled=!0}function handleFileSelect(e){if(e.target.files){selDiv=document.querySelector("#selectedFiles"),selDiv.innerHTML="",files=e.target.files;for(var t=0;t<files.length;t++){var i=files[t];selDiv.innerHTML+=i.name+"<br/>"}document.getElementById("submit_upload").disabled=!1}}function allowDrop(e){e.preventDefault()}function drag(e){e.dataTransfer.setData("text",e.target.id)}function drop(e){e.preventDefault();var t=e.target.id;if(t&&("uploadBox"==t||"uploadImg"==t||t.indexOf("folder")>=0)){e.dataTransfer.getData("text");if(path=$("#path").val(),e.target.getAttribute("path")?(path=e.target.getAttribute("path"),t=t.replace("folder","selectFiles"),selDiv=document.querySelector("#"+t)):selDiv=document.querySelector("#selectedFiles"),null===path)return void alert(i18n("path_not_empty"));for(var i=e.dataTransfer.items,n=[],a=0;a<i.length;a++)"string"==i[a].kind&&"application/x-moz-file-promise-url"==i[a].type?i[a].getAsString(function(e){if(e.indexOf("http")>=0&&null==n[e]){if(n[e]=!0,e.indexOf("viewimage?uid=")>0){var t=e.split("viewimage?uid=")[1];return t=t.split("&")[0],selDiv.innerHTML='<section class="alert alert-info"><h2 class="h3">'+i18n("proccess")+"</h2><p><img alt='' src='"+contentPath+"/resources/images/ui-anim_basic_16x16.gif'/> "+e+"</p></section>",void $.ajax({url:contentPath+"/importAssetMove.html?path="+path+"&uid="+t,type:"GET",contentType:!1,processData:!1,success:function(e){if(e.title.indexOf("error:")>=0)selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+"</h2><p>"+e.title+"</p></section>";else{$("#"+t).remove(),selDiv.innerHTML='<section class="alert alert-success"><h2 class="4">'+i18n("success")+"</h2><p>"+e.title+"</p></section>";var i=$("#div_uid").html();i=i.split("{uid}").join(e.uid),i=i.replace("imgreplace","img"),i=i.replace("{title}",e.title),i=i.replace("{icon}",e.icon),i=i.replace("{link}",e.link),$("#top_insert").after(i)}},error:function(){selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+"</h2></section>"}})}return selDiv.innerHTML='<section class="alert alert-info"><h2 class="h3">'+i18n("upload")+"</h2><p><img alt='' src='"+contentPath+"/resources/images/ui-anim_basic_16x16.gif'/> "+e+"</p></section>",void $.ajax({url:contentPath+"/importAsset.html?path="+path+"&url="+e,type:"GET",contentType:!1,processData:!1,success:function(e){if(e.title.indexOf("error:")>=0)selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("success")+"</h2><p>"+e.title+"</p></section>";else{selDiv.innerHTML='<section class="alert alert-success"><h2 class="4">'+i18n("success")+"</h2><p>"+e.title+"</p></section>";var t=$("#div_uid").html();t=t.split("{uid}").join(e.uid),t=t.replace("imgreplace","img"),t=t.replace("{title}",e.title),t=t.replace("{icon}",e.icon),t=t.replace("{link}",e.link),$("#top_insert").after(t)}},error:function(){selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+"</h2></section>"}})}}):"text/html"==i[a].type&&i[a].getAsString(function(e){var t=$(e).find("img");if(t.length>0){var i=t.attr("src");if(i.indexOf("http")>=0&&null==n[i]){if(n[i]=!0,i.indexOf("viewimage?uid=")>0){var a=i.split("viewimage?uid=")[1];return a=a.split("&")[0],selDiv.innerHTML='<section class="alert alert-info"><h2 class="h3">'+i18n("upload")+"</h2><p><img alt='' src='"+contentPath+"/resources/images/ui-anim_basic_16x16.gif'/> "+i+"</p></section>",void $.ajax({url:contentPath+"/importAssetMove.html?path="+path+"&uid="+a,type:"GET",contentType:!1,processData:!1,success:function(e){if(e.title.indexOf("error:")>=0)selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+"</h2><p>"+e.title+"</p></section>";else{$("#"+a).remove(),selDiv.innerHTML='<section class="alert alert-success"><h2 class="4">'+i18n("success")+"</h2><p>"+e.title+"</p></section>";var t=$("#div_uid").html();t=t.split("{uid}").join(e.uid),t=t.replace("imgreplace","img"),t=t.replace("{title}",e.title),t=t.replace("{icon}",e.icon),t=t.replace("{link}",e.link),$("#top_insert").after(t)}},error:function(){selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+"</h2></section>"}})}return selDiv.innerHTML='<section class="alert alert-info"><h2 class="h3">'+i18n("upload")+"</h2><p><img alt='' src='"+contentPath+"/resources/images/ui-anim_basic_16x16.gif'/> "+i+"</p></section>",$.ajax({url:contentPath+"/importAsset.html?path="+path+"&url="+i,type:"GET",contentType:!1,processData:!1,success:function(e){if(e.title.indexOf("error:")>=0)selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+" </h2><p>"+e.title+"</p></section>";else{selDiv.innerHTML='<section class="alert alert-success"><h2 class="4">'+i18n("success")+"</h2><p>"+e.title+"</p></section>";var t=$("#div_uid").html();t=t.split("{uid}").join(e.uid),t=t.replace("imgreplace","img"),t=t.replace("{title}",e.title),t=t.replace("{icon}",e.icon),t=t.replace("{link}",e.link),$("#top_insert").after(t)}},error:function(){selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+"</h2></section>"}}),void(n[i]=!0)}}});files=[],droppedFiles=e.dataTransfer.files;var i=e.dataTransfer.items;topInsert.innerHTML="";for(var a=0;a<droppedFiles.length;a++){if(null!=i){var s=i[a].webkitGetAsEntry();if(s.isDirectory){selDiv.innerHTML='<section class="alert alert-info"><h2 class="h3">'+i18n("create_folder")+droppedFiles[a].name+"...</h2></section>",$("#foldername").val(droppedFiles[a].name),$("#titlefolder").val(droppedFiles[a].name),createFolder();continue}}files[a]=droppedFiles[a]}e.target.classList.remove("well"),e.target.style.border="1px solid #aaaaaa"}files.length>0&&(a=0,uploadFiles())}function uploadFolder(){var e=$("#folderPath").val();$.ajax({url:contentPath+"/importFolder.html?path="+path+"&url="+e,type:"GET",contentType:!1,processData:!1,success:function(e){e.indexOf("error:")>=0?selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+"</h2><p>"+e+"</p></section>":selDiv.innerHTML='<section class="alert alert-info"><h2 class="h3">'+i18n("upload_at_backend")+"</h2>"+e+"</section>"},error:function(){selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+"</h2></section>"}})}function uploadFile(e){var t='<img src="'+contentPath+'/resources/images/ui-anim_basic_16x16.gif">'+e.name+"<br/>";selDiv.innerHTML=t;var n=new FormData;n.append("path",path),n.append("file",e,e.name),n.append("filename",e.name),n.append("lastModified",e.lastModified);var a=0;if(a="size"in e?e.size:e.fileSize,a>2e8)return void(selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("document_limit")+"200MB</h2></section>");var s=new Date,l=new Date;$.ajax({xhr:function(){var i=new window.XMLHttpRequest;return i.upload.addEventListener("progress",function(i){if(i.lengthComputable){l=new Date;var n=0;n=8*i.loaded/(l.getTime()-s.getTime()),percentComplete=i.loaded/i.total*100,selDiv.innerHTML='<section id="'+e.name+'"><h5>'+t+'</h5><progress class="full-width" value="'+i.loaded+'" max="'+i.total+'"><span class="wb-inv">'+percentComplete+"%</span></progress></section>",selDiv.innerHTML+="<p>"+(n/1e3).toFixed(2)+" MB/s</p>"}},!1),i.addEventListener("progress",function(t){t.lengthComputable&&(percentComplete=t.loaded/t.total*100,selDiv.innerHTML='<section id="'+e.name+'"><h5>'+e.name+'</h5><progress class="full-width" value="'+t.loaded+'" max="'+t.total+'"><span class="wb-inv">'+percentComplete+"%</span></progress></section>")},!1),i},url:contentPath+"/uploadAsset.html",data:n,type:"POST",contentType:!1,processData:!1,enctype:"multipart/form-data",success:function(t){if(percentComplete=1e3,t.title.indexOf("error:")>=0)selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h5">'+i18n("fail")+"</h2><p>"+t.title+"</p></section>";else{var n=0;n=8*a/(l.getTime()-s.getTime()),selDiv.innerHTML='<section id="'+e.name+'"><h5>'+e.name+"("+(n/1e3).toFixed(2)+' MS/s)</h5><progress class="full-width" value="'+a+'" max="'+a+'"><span class="wb-inv">100%</span></progress></section>',selDiv.innerHTML+='<section class="alert alert-success"><h3 class="5">'+(i+1)+i18n("document_uploaded")+i18n("success")+"</h3></section>";var r=$("#div_uid").html();r=r.split("{uid}").join(t.uid),r=r.replace("imgreplace","img"),r=r.replace("{title}",t.title),r=r.replace("{link}",t.link),r=r.replace("{icon}",t.icon),r=r.replace("-edit",""),$("#top_insert").after(r)}},error:function(){selDiv.innerHTML='<section class="alert alert-warning"><h2 class="h3">'+i18n("fail")+"</h2></section>"}})}function uploadFiles(){selDiv.innerHTML="",percentComplete=0,total=files.length,i=0,document.getElementById("submit_upload").disabled=!0,uploadFile(files[i]),setTimeout(checkProgress,1e3)}function checkProgress(){1e3==percentComplete&&total-1>i?(i++,uploadFile(files[i]),setTimeout(checkProgress,1e3)):total-1>i?setTimeout(checkProgress,1e3):(i==total-1||0==total)&&(selDiv.innerHTML+="<h5>"+(i+1)+i18n("document_uploaded")+","+i18n("process")+"</h5>")}function deleteNode(e){confirm(i18n("are_you_sure_delete")+e+"?")&&$.ajax({url:contentPath+"/delete.html",data:{path:e},type:"POST",success:function(t){!t.indexOf("error:")>=0?$("#"+e).remove():alert(t)},error:function(){alert(i18n("fail"))}})}function deleteNode(e,t){confirm(i18n("are_you_sure_delete")+e+"?")&&$.ajax({url:contentPath+"/delete.html",data:{path:e},type:"POST",success:function(e){!e.indexOf("error:")>=0?$("#"+t).remove():alert(e)},error:function(){alert(i18n("fail"))}})}function deleteUser(e){confirm(i18n("are_you_sure_delete")+e+"?")&&$.ajax({url:contentPath+"/delete.html",data:{path:e},type:"POST",success:function(e){!e.indexOf("error:")>=0?window.location.href="usermanager.html":alert(e)},error:function(){alert(i18n("fail"))}})}function removeTag(e){confirm(i18n("are_you_sure_delete")+e+"?")&&$.ajax({url:contentPath+"/delete.html",data:{uid:e},type:"POST",success:function(t){!t.indexOf("error:")>=0?$("#"+e).remove():alert(t)},error:function(){alert(i18n("fail"))}})}function setDataView(e,t){var i=document.getElementById("left-bar");i.classList.contains("wb-inv")&&i.classList.remove("wb-inv")}function ftrClose(e){$("#ftrClose").click(),$(document).trigger("open.wb-lbx",[[{src:e,type:"ajax"}]])}var files;$(window).on("load",function(){var e=document.getElementById("wb-lng");e&&e.classList.remove("wb-inv")});var contentPath="";window.location.pathname.indexOf("/smarti-cloud")>=0&&(contentPath="/smarti-cloud");var path="",type="image",selDiv="",topInsert="",input="";document.addEventListener("DOMContentLoaded",init,!1);var i18n=window.wb.i18n,percentComplete=0,total=0,i=0;document.addEventListener("dragenter",function(e){var t=e.target.id;t&&("uploadBox"==t||"uploadImg"==t||t.indexOf("folder")>=0)&&(e.target.classList.add("well"),e.target.style.border="3px dotted blue")}),document.addEventListener("dragover",function(e){e.preventDefault()}),document.addEventListener("dragleave",function(e){var t=e.target.id;t&&("uploadBox"==t||"uploadImg"==t||t.indexOf("folder")>=0)&&(e.target.style.border="1px solid #aaaaaa",e.target.classList.remove("well"))}),window.addEventListener("drop",function(e){e=e||event,e.preventDefault()},!1);