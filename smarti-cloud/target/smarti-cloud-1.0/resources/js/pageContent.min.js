function updateNode(){var e=this.getAttribute("id"),t=this.getAttribute("uid"),n=this.getAttribute("path"),a=this.getAttribute("name"),i=this.getAttribute("type"),s="checkbox"==i?$(this).is(":checked"):this.value;t?$.ajax({url:contentPath+"/updateProperty.html",data:{uid:t,path:n,name:a,value:s},type:"POST",success:function(n){"checkbox"==i?(document.getElementById(e).parentNode.classList.add("alert-success"),"true"==s||1==s?document.getElementById("link"+t).classList.add("wb-inv"):document.getElementById("link"+t).classList.remove("wb-inv")):n.indexOf("error:")>=0?document.getElementById(e).classList.add("alert-warning"):document.getElementById(e).classList.add("alert-success")},error:function(){document.getElementById(e).classList.add("alert-warning")}}):alert("uid is missing")}function fileBrowserCallBack(e,t,n,a){var i=contentPath+"/"+n+".html",s=window.location.search;return s=(s.length<1,"?"),tinyMCE.activeEditor.windowManager.open({file:i+s.trim()+"type="+n+"&input="+e+"&cachebuster=123",title:"文件浏览",width:420,height:560,resizable:"yes",inline:"yes",close_previous:"yes"},{window:a,input:e}),!1}function sendChat(e){$("#chat_message").html("<section class='alert alert-info'><h5>"+i18n("sending")+"</h5><section>"),$("#online_chat_running").removeClass("wb-inv"),$("#online_chat_send").attr("disabled",!0);var t=tinymce.get("online_chat_editor");t?$.ajax({url:contentPath+"/protected/addchat.html",type:"POST",data:{path:e,content:t.getContent()},success:function(e){e.indexOf("error:")>=0?$("#chat_message").html("<section class='alert alert-danger'><h5>"+i18n("fail")+"</h5><p>"+e+"</p><section>"):$("#chat_message").html("<section class='alert alert-success'><h5>"+i18n("success")+"</h5><section>"),path=e,syncChat(),tinyMCE.activeEditor.setContent("<p></p>"),$("#online_chat_running").addClass("wb-inv")},error:function(){window.location.href=contentPath+"/login?redirect="+window.location.href}}):$("#chat_message").html("<section class='alert alert-danger'><h5>编辑器没找到</h5><section>")}function sendComment(e,t){var n=tinymce.get("online_comment_editor"),a=n.getContent();if(""==a)return void $("#comment_message").html("<section class='alert alert-info'><h5>"+i18n("no_comment")+".</h5><section>");if(comment==a)return void $("#comment_message").html("<section class='alert alert-info'><h5>"+i18n("coment_sent")+".</h5><section>");comment=a,$("#comment_message").html("<section class='alert alert-info'><h5>"+i18n("sending")+"</h5><section>"),$("#online_comment_running"+t).removeClass("wb-inv"),$("#online_comment_send").attr("disabled",!0);var n=tinymce.get("online_comment_editor");n?$.ajax({url:contentPath+"/protected/addcomment.html",type:"POST",data:{path:e,status:t,content:comment},success:function(e){e.indexOf("error:")>=0?$("#comment_message").html("<section class='alert alert-danger'><h5>"+i18n("fail")+"</h5><p>"+e+"</p><section>"):$("#comment_message").html("<section class='alert alert-success'><h5>"+i18n("success")+"</h5><section>"),path=e,tinyMCE.activeEditor.setContent("<p></p>"),$("#online_comment_running"+t).addClass("wb-inv")},error:function(){$("#online_comment_running"+t).addClass("wb-inv"),window.location.href=contentPath+"/login?redirect="+window.location.href}}):$("#comment_message").html("<section class='alert alert-danger'><h5>"+i18n("fail")+", no editor</h5><section>"),setTimeout(function(){$("#online_comment_send").attr("disabled",!1)},3e4)}function djchat(e){$(".wb-overlay").trigger("wb-init.wb-overlay"),$(".wb-overlay").trigger("open.wb-overlay")}function syncChat(){$("#online_chat_running").removeClass("wb-inv"),$("#online_chat_send").attr("disabled",!0),$.ajax({url:contentPath+"/protected/chat.json",data:{path:path,lastModified:new Date(lastModified).toISOString()},type:"GET",contentType:"application/json",success:function(e){setTimeout(function(){$("#online_chat_send").attr("disabled",!1)},3e3),$.each(e.items,function(e,t){if(t.lastModified>lastModified){var n="",a=new Date(t.lastModified);path.indexOf("/content/"+t.createdBy)>=0?(n='<div id="'+t.uid+'" class="panel panel-default"><header class="panel-heading">',n+='<h5 class="panel-title">'+t.createdBy+' <span class="small text-left">'+a.toISOString()+"</span><a href=\"javascript:removeTag('"+t.uid+'\')"><img title="点击删除" class="pull-right" src="'+contentPath+'/resources/images/cut.gif"></a></h5>'):(n='<div id="'+t.uid+'" class="panel panel-success"><header class="panel-heading">',n+='<h5 class="panel-title">'+t.createdBy+' <span class="small">'+a.toISOString()+"</span><a href=\"javascript:removeTag('"+t.uid+'\')"><img title="点击删除" class="pull-right" src="'+contentPath+'/resources/images/cut.gif"></a></h5>'),n+='</header><div class="panel-body">'+t.content+'</div></div><div class="clearfix"></div>',$("#online_chat").append(n),lastModified=t.lastModified}}),e.pageCount>1?setTimeout(syncChat,1e4):setTimeout(syncChat,3e4),$("#chat").attr("open")?$("#online_notice").html(""):e.pageCount>0&&(unreadCount+=e.pageCount,$("#online_notice").html(""+unreadCount)),$("#online_chat_running").addClass("wb-inv")},error:function(){$("#online_chat_running").addClass("wb-inv"),$("#online_chat").html('<section class="alert alert-warning"><h5>你没有登入！</53></section>')}})}function errorException(e,t){busy=0,0===e.status?$("#header_message").html('<section class="alert alert-warning"><h3>'+i18n("fail")+"</h3></section>"):404==e.status?alert("Requested page not found. [404]"):500==e.status?alert("Internal Server Error [500]."):"parsererror"===t?alert("Requested JSON parse failed."):"timeout"===t?alert("Time out error."):"abort"===t?alert("Ajax request aborted."):alert("Uncaught Error.\n"+e.responseText)}var i18n=window.wb.i18n,path="",lastModified=0,unreadCount=0,contentPath="",comment="";window.location.pathname.indexOf("/smarti-cloud")>=0&&(contentPath="/smarti-cloud"),$("#pagePath")&&(path=$("#pagePath").val()),tinymce.init({selector:"div.online_editor",language:"zh_CN.GB2312",content_css:contentPath+"/resources/dist/css/wet-boew.min.css,"+contentPath+"/resources/css/tiny_mce_editor.css",inline:!0,plugins:["link image emoticons"],toolbar:"undo redo styleselect link image emoticons",menubar:!1,image_class_list:[{title:"Image Responsive",value:"img-responsive"},{title:"Image Thumbnail",value:"thumbnail"},{title:"Image Thumbnail Responsive",value:"img-responsive thumbnail"},{title:"None",value:""}],image_default_attributes:{"class":"img-responsive"},file_browser_callback:function(e,t,n,a){fileBrowserCallBack(e,t,n,a)}}),null!=path&&""!=path&&syncChat();