function allowDrop(e){e.preventDefault()}function drag(e){e.dataTransfer.setData("text",e.target.id)}function createPage(){var e=$("#createPage").serializeArray();document.getElementById("submit_upload").disabled=!0,$.ajax({url:contentPath+"/createPage.html",data:e,type:"POST",success:function(e){0==e.indexOf("/content")?window.location.href="editor.html?path="+e:$("#error").html('<section class="alert alert-warning">'+e+"</section>")},error:function(){$("#error").html(i18n("fail"))}})}function createFolder(){var e=$("#createFolder").serializeArray();$.ajax({url:contentPath+"/createFolder.html",data:e,type:"POST",success:function(e){e.indexOf("error:")>0?$("#header_message").html('<section class="alert alert-warning"><h3>'+i18n("fail")+"</h3><p>"+e+"</p></section>"):window.location.reload()},error:function(){$("#header_message").html('<section class="alert alert-warning"><h3>'+i18n("fail")+"</h3><p></p></section>")}})}function deleteAsset(e,t){$.ajax({url:contentPath+"/deleteasset.html",data:{path:e},type:"POST",success:function(e){e.indexOf("error:")>0?$("#header_message").html('<section class="alert alert-warning"><h3>'+i18n("fail")+"</h3><p>"+e+"</p></section>"):$("#"+t).remove()},error:function(){$("#header_message").html('<section class="alert alert-warning"><h3>'+i18n("fail")+"</h3><p></p></section>")}})}function deletePage(e,t){$.ajax({url:contentPath+"/delete.html",data:{path:e},type:"POST",success:function(e){e.indexOf("error:")>0?$("#header_message").html('<section class="alert alert-warning"><h3>'+i18n("fail")+"</h3><p>"+e+"</p></section>"):window.location.href="editor.html?path="+t},error:function(){$("#header_message").html('<section class="alert alert-warning"><h3>'+i18n("fail")+"</h3><p></p></section>")}})}function updateTemplate(){document.getElementById("template");var e=document.getElementById("template_uid").value,t=document.getElementById("template_content").value;$.ajax({url:contentPath+"/updateProperty.html",data:{uid:e,name:"content",value:t},type:"POST",success:function(e){e.indexOf("error:")>=0?$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("fail")+"</h3><p>"+e+"</p></section>"):$("#header_message").html("<section class='alert alert-success'><h3>"+i18n("success")+"</h3></section>")},error:function(){$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("fail")+"</h3></section>")}})}function publish(e){$("#header_message").html("<section class='alert alert-info'><h3>"+i18n("process")+"</h3></section>"),$.ajax({url:contentPath+"/publish.html",data:{uid:e,name:"status",value:"true"},type:"POST",success:function(e){e.indexOf("error:")>=0?$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("publish")+i18n("fail")+"</h3><p>"+e+"</p></section>"):$("#header_message").html("<section class='alert alert-success'><h3>"+i18n("publish")+i18n("success")+"</h3></section>")},error:function(){$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("publish")+i18n("fail")+"</h3></section>")}})}function publishFolder(e){$("#modal_message").html("<section class='alert alert-info'><h3>"+i18n("process")+"</h3></section>"),$.ajax({url:contentPath+"/publishfolder.html",data:{uid:e,name:"status",value:"true"},type:"POST",success:function(e){e.indexOf("error:")>=0?$("#modal_message").html("<section class='alert alert-danger'><h3>"+i18n("publish")+i18n("fail")+"</h3><p>"+e+"</p></section>"):$("#modal_message").html("<section class='alert alert-success'><h3>"+i18n("success")+i18n("publish")+e+i18n("page")+"</h3></section>")},error:function(){$("#modal_message").html("<section class='alert alert-danger'><h3>"+i18n("publish")+i18n("fail")+"</h3></section>")}})}function init(){for(var e=document.querySelectorAll(".form-editable"),t=0;t<e.length;t++)e[t].addEventListener("change",updateThis)}function fileBrowserCallBack(e,t,a,n){var i=contentPath+"/"+a+".html",s=window.location.search;return s=(s.length,"?"),tinyMCE.activeEditor.windowManager.open({file:i+s.trim()+"type="+a+"&input="+e+"&cachebuster=123",title:"Select Assets",width:420,height:560,resizable:"yes",inline:"yes",close_previous:"yes"},{window:n,input:e}),!1}function showImages(e){$("#left-iframe").html('<iframe src="'+contentPath+'/browse.html" width="100%" height="600"  frameBorder="0"></iframe>')}function showVideos(e){$("#left-iframe").html('<iframe src="'+contentPath+'/media.html" width="100%" height="600"  frameBorder="0"></iframe>')}function showTemplates(e){$("#left-iframe").html('<iframe src="'+contentPath+'/templates.html" width="100%" height="600"  frameBorder="0"></iframe>')}function showPages(e){$("#left-iframe").html('<iframe src="'+contentPath+'/pages.html" width="100%" height="600"  frameBorder="0"></iframe>')}function openPdf(){for(var e=document.getElementsByName("puid"),t="",a=0;a<e.length;a++)e[a].checked&&(t+=""==t?"?uid="+e[a].value:"&uid="+e[a].value);""!=t?(t="viewpdf"+t,window.location.href=t):$("#header_message").html("<section class='alert alert-warning'><h3>"+i18n("select_andthen_open")+"</h3></section>")}function rotate(e){$("#rotate_running"+e).removeClass("wb-inv");var t=$("#rotate"+e).val();$.ajax({url:contentPath+"/rotateImage.html",data:{uid:e,angle:t},type:"POST",success:function(t){t.indexOf("error:")>=0?$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("fail")+"</h3><p>"+t+"</p></section>"):($("#img"+e).attr("src","viewimage?uid="+e+"&t="+(new Date).getTime()),$("#header_message").html("<section class='alert alert-success'><h3>"+i18n("success")+"</h3></section>")),$("#rotate_running"+e).addClass("wb-inv")},error:function(){$("#rotate_running"+e).addClass("wb-inv"),$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("fail")+"</h3></section>")}})}function editImage(e){var t=$("#editImage");t.attr("uid",e),t.html("<img alt='' src=\"file?uid="+e+'" class="img-responsive">')}var contentPath="",carousel="",el=document.querySelector(".carousel"),i18n=window.wb.i18n;el&&(carousel=el.innerHTML),window.location.pathname.indexOf("/smarti-cloud")>=0&&(contentPath="/smarti-cloud"),tinymce.init({selector:"h2.caneditable",inline:!0,toolbar:"undo redo",menubar:!1}),tinymce.init({selector:"div.description",inline:!0,language:"zh_CN.GB2312",plugins:["save paste advlist autolink lists link imagetools autosave"],toolbar:"save undo redo paste",autosave_ask_before_unload:!1,autosave_interval:"20s",menubar:!1,save_onsavecallback:function(){var e=tinyMCE.activeEditor.id,t=e.replace("description",""),a=document.getElementById(e).getAttribute("property")||"description";if(t){var n=tinyMCE.activeEditor.getContent();$.ajax({url:contentPath+"/updateNodeProperty.html",data:{uid:t,name:a,value:n},type:"POST",success:function(e){e.indexOf("error")>=0?$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("save")+i18n("fail")+"!</h3>"+e+"</section>"):$("#header_message").html("<section class='alert alert-info'><h3>"+i18n("save")+i18n("success")+"!</h3></section>")},error:function(){$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("save")+i18n("fail")+"!</h3></section>")}})}else $("#header_message").html("uid is missing,name="+a)}}),tinymce.init({selector:"div.image",inline:!0,language:"zh_CN.GB2312",plugins:["save paste imagetools autosave"],toolbar:"save undo redo paste | advlist autolink lists link",autosave_ask_before_unload:!1,menubar:!1,save_onsavecallback:function(){var e=tinyMCE.activeEditor.id,t=e.replace("description",""),a=document.getElementById(e).getAttribute("property")||"description";if(t){var n=tinyMCE.activeEditor.getContent(),i=new FormData;i.append("name",a),i.append("uid",t),i.append("value",n),$.ajax({url:contentPath+"/updateImage.html",data:i,type:"POST",processData:!1,contentType:!1,success:function(e){e.indexOf("error")>=0?$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("save")+i18n("success")+"!</h3>"+e+"</section>"):$("#header_message").html("<section class='alert alert-info'><h3>"+i18n("save")+i18n("success")+"!</h3></section>")},error:function(){$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("save")+i18n("success")+"!</h3></section>")}})}else $("#header_message").html("uid is missing,name="+a)}}),tinymce.init({selector:"div.caneditable",language:"zh_CN.GB2312",content_css:contentPath+"/resources/dist/css/wet-boew.min.css,"+contentPath+"/resources/css/tiny_mce_editor.css",inline:!0,plugins:["save advlist autolink lists link image imagetools template charmap print preview anchor","noneditable searchreplace visualblocks code fullscreen","insertdatetime media table carousel contextmenu paste"],convert_urls:!1,relative_urls:!0,noneditable_noneditable_class:"noneditable",noneditable_editable_class:"editable",noneditable_regexp:/\[\[[^\]]+\]\]/g,contextmenu:"link image media inserttable template | cell row column deletetable",templates:contentPath+"/content/components.json",table_class_list:[{title:"None",value:""},{title:"Wet-table",value:"wb-tables table"},{title:"Wet-table,strip",value:"wb-tables table table-striped table-hover"},{title:"Wet-table,strip,bordered",value:"wb-tables table table-striped table-hover table-bordered"}],table_default_attributes:{class:"wb-tables table"},image_class_list:[{title:"Image Responsive",value:"img-responsive"},{title:"Image Thumbnail",value:"thumbnail"},{title:"Image Thumbnail Responsive",value:"img-responsive thumbnail"},{title:"Pull left",value:"pull-left img-responsive"},{title:"Pull right",value:"pull-right img-responsive"},{title:"None",value:""}],image_default_attributes:{class:"img-responsive"},link_class_list:[{title:"None",value:""},{title:"Button",value:"btn btn-default"},{title:"Button fullwidth",value:"btn btn-default btn-block"},{title:"Button primary",value:"btn btn-primary"},{title:"Button success",value:"btn btn-success"},{title:"Button warning",value:"btn btn-warning"},{title:"Button info",value:"btn btn-info"},{title:"Button danger",value:"btn btn-danger"},{title:"Lightbox",value:"wb-lbx"},{title:"Footnote",value:"fn-lnk"}],file_browser_callback:function(e,t,a,n){fileBrowserCallBack(e,t,a,n)},file_browser_callback_types:"file image media",toolbar:"save insert undo redo | outdent indent bullist numlist | link image media paste | template",save_enablewhendirty:!0,save_onsavecallback:function(){var e=tinyMCE.activeEditor.id,t=document.getElementById(e).getAttribute("property")||"content";if(e){var a=tinyMCE.activeEditor.dom.select(".carousel");a.length>0&&(a[0].innerHTML=carousel),tinyMCE.DOM.removeClass("div","wb-data-ajax-replace-inited"),tinyMCE.DOM.removeClass("div","wb-init"),tinyMCE.DOM.removeClass("div","wb-tabs-inited");var n=tinyMCE.activeEditor.getContent();n=n.replace("-edit",""),$("#header_message").html("<section class='alert alert-info'><h3>"+i18n("save")+"...</h3></section>"),$.ajax({url:contentPath+"/updateProperty.html",data:{uid:e,name:t,value:n},type:"POST",success:function(e){e.indexOf("error")>=0?$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("save")+i18n("fail")+"!</h3>"+e+"</section>"):$("#header_message").html("<section class='alert alert-info'><h3>"+i18n("save")+i18n("success")+"!</h3></section>")},error:function(){$("#header_message").html("<section class='alert alert-danger'><h3>"+i18n("save")+i18n("fail")+"!</h3></section>")}})}else $("#error").html(i18n("fial")+t)}}),tinymce.init({selector:".h2",language:"zh_CN.GB2312",plugins:"table",inline:!0}),document.addEventListener("dragenter",function(e){e.target.className&&e.target.className.indexOf("component")>=0&&(e.target.style.border="3px dotted red")}),document.addEventListener("dragover",function(e){e.preventDefault()}),document.addEventListener("DOMContentLoaded",init,!1),document.addEventListener("dragleave",function(e){e.target.className&&e.target.className.indexOf("component")>=0&&(e.target.style.border="")}),window.addEventListener("dragover",function(e){(e=e||event).preventDefault()},!1),window.addEventListener("drop",function(e){(e=e||event).preventDefault()},!1);